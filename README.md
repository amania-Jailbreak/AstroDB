# AstroDB

AstroDB は、AstroNetwork プロジェクトで使用するために設計されたプロトタイプデータベースです。このプロジェクトは、インメモリデータベースのコア機能、認証・認可、データ永続性、および高度なクエリ機能を提供します。

なおこのプロジェクトは 95%ほど gemini-cli および Github Copilot にて作成されております。

あくまで個人用途での使用を想定しており実環境での使用は一切責任を負いかねます

## 特徴

-   **基本的な CRUD 操作:** ドキュメントの挿入（`insert_one`, `insert_many`）、検索（`find`, `find_one`, `find_many`）、更新（`update_one`, `update_many`）、削除（`delete_one`, `delete_many`）をサポートします。
-   **認証・認可:** ユーザー登録、ログイン、JWT（JSON Web Token）ベースの認証を実装しています。ユーザー情報はデータベースに永続化されます。
-   **データ永続性:** データベースへの変更は、書き込みごとにディスクに保存されるのではなく、非同期に数分ごとに自動的にディスク（`database.adb`）に保存されます。これにより、パフォーマンスへの影響を最小限に抑えつつ、クラッシュ時のデータ損失リスクを軽減します。
-   **クエリエンジンの機能拡張:**
    -   ネストされたオブジェクトの検索（ドット記法: `{"user.profile.age": 25}`）をサポートします。
    -   配列内の要素に対するクエリ（`{"tags": "python"}` で `tags` 配列に "python" が含まれるドキュメントを検索）をサポートします。
    -   `$regex` (正規表現マッチ)、`$size` (配列のサイズ)、`$exists` (フィールドの存在チェック) などの高度なクエリ演算子をサポートします。
-   **ロギング:** アプリケーション全体で Python の標準`logging`モジュールを使用し、詳細な情報、警告、エラーをコンソールに出力します。非同期ロギングも実装されており、パフォーマンスへの影響を最小限に抑えます。
-   **認証レートリミット:** ログイン試行回数に対する基本的なレートリミット機構が導入されています。

## はじめに

### 依存関係のインストール

プロジェクトの依存関係をインストールします。

```bash
pip install -r requirements.txt
```

### サーバーの実行

サーバーをバックグラウンドで起動します。

```bash
python server.py &
```

サーバーは `http://127.0.0.1:8000` でリッスンし、WebSocket エンドポイントは `ws://127.0.0.1:8000/ws` です。

### クライアントとの対話

`client.py` スクリプトを使用して、サーバーと対話できます。

```bash
python client.py
```

クライアント内で `help` と入力すると、利用可能なコマンドのリストが表示されます。

## ベンチマーク

`benchmark.py` スクリプトは、WebSocket 経由でサーバーと通信し、主要なデータベース操作（挿入、検索、更新、削除）のパフォーマンスを測定します。

ベンチマークを実行する前に、サーバーが起動していることを確認してください。

```bash
python benchmark.py
```

## テスト

`run_all_tests.py` スクリプトは、プロジェクトのすべての単体テストを実行します。

```bash
python run_all_tests.py
```

## 今後の改善点

-   **より堅牢なエラーハンドリング:** ネットワークの不安定性や予期せぬデータ形式など、より多くのエッジケースに対応するためのエラーハンドリングの強化。
-   **インデックスの自動管理:** クエリパターンに基づいてインデックスを自動的に作成・最適化する機能。
-   **レプリケーションとシャーディング:** データの可用性とスケーラビリティを向上させるための機能。
-   **クエリ最適化:** より複雑なクエリに対するパフォーマンスを向上させるためのクエリプランナーの実装。
